[UNCLAIMED.PROPERTY.LETTER.RPT]

TARGET=ACCOUNT

DEFINE
 #INCLUDE "RB.CN.GENERAL.DEF"
 RPTMINUTES=180     [Number of minutes since generation of RPT file]
 I=NUMBER              [Loop Counter]
 OUTPUTERROR=CHARACTER
 #INCLUDE "RD.OUTPUT.DEF"
 CH1=NUMBER
 CH2=NUMBER
 ERRORTEXT=CHARACTER
 ERRORMESSAGE=CHARACTER
 PRINTLINE=NUMBER
 TEMPNUM=NUMBER
 CNT=NUMBER 
 X=NUMBER
 LGTH=NUMBER
 DBA=CHARACTER
 FIRST=NUMBER
 PREVACCT=CHARACTER(10)
 CURRACCT=CHARACTER(10)
 TESTACCT=CHARACTER(10)
 PREVSSN=CHARACTER(9)
 CURRSSN=CHARACTER(9)
 FIRSTACCT=NUMBER
  CHANNEL1=NUMBER
 
 ARCHIVEFILENAME=CHARACTER
 FLINE1=CHARACTER
 FLINE2=CHARACTER
 FLINE3=CHARACTER
 FLINESMALLEST=CHARACTER
 JOINTFLAG=NUMBER
 LOWBALCOUNT=NUMBER
 LOWBALTOTAL=MONEY
 TOTALCOUNT=NUMBER


END                [/DEFINE]

SETUP
 CNT=0
 LOWBALCOUNT=0
 TOTALCOUNT=0
 FIRSTACCT=TRUE
 JOINTFLAG=0
 
 ARCHIVEFILENAME="UNCLAIMED.ACCT.LIST"                   [LOW BAL ACCT]
 FILEOPEN("LETTER",ARCHIVEFILENAME,"READ",CHANNEL1,ERRORTEXT)
 IF ERRORTEXT<>"" THEN
    DO
     ERRORMESSAGE="File Read Error: "+ERRORTEXT
     CALL HANDLEERROR
    END
END                [/SETUP] 

SELECT
 ALL
END                [/SELECT]

SORT
 ACCOUNT:NUMBER
END

PRINT TITLE="UNCLAIMED LETTER EXTRACT"

 HEADERS
  COL=001 "ACCOUNT"
  COL=012 "FIRST"
  COL=042 "LAST"
  COL=059 "STREET"
  COL=099 "CITY"
  COL=119 "ST"
  COL=122 "ZIP"
  NEWLINE
 END
 
 X=0
 WHILE ERRORTEXT=""
  DO
   FILEREADLINE(CHANNEL1,LINETEXT,ERRORTEXT)
  IF SEGMENT(LINETEXT,1,10)="" THEN
   PRINTLINE=0
  IF SEGMENT(LINETEXT,1,10)<>"" THEN
   PRINTLINE=1
  IF PRINTLINE=1 THEN
   DO
     CURRACCT=SEGMENT(LINETEXT,1,10)
     IF (CURRACCT<>"" AND CURRACCT<>PREVACCT) THEN
	  DO
	   FOR ACCOUNT WITH NUMBER CURRACCT
	    DO
	     IF NAME:TYPE=0 THEN
		  DO
	       COL=001 SEGMENT(ACCOUNT:NUMBER,7,10)
		   IF NAME:FIRST="" THEN
		    DO
			 COL=012 NAME:LAST
		     COL=059 NAME:STREET
		     COL=99 NAME:CITY
		     COL=119 NAME:STATE
		     COL=122 NAME:ZIPCODE
		     CNT=CNT+1
		     NEWLINE
			END
		   ELSE IF NAME:FIRST<>"" THEN
		    DO
		    COL=012 NAME:FIRST
		    COL=042 NAME:LAST
		    COL=059 NAME:STREET
		    COL=99 NAME:CITY
		    COL=119 NAME:STATE
		    COL=122 NAME:ZIPCODE
		    CNT=CNT+1
		    NEWLINE
		   END
	      END
	    END
	  END
	PREVACCT=CURRACCT
	CURRACCT=""
   END
  END
END

TOTAL
 PRINT "COUNT: "
 PRINT CNT
 NEWLINE
END

PROCEDURE HANDLEERROR
[
|  Error handling routine.  Print out ERRORMESSAGE and TERMINATE
]

 NEWLINE
 NEWLINE
 PRINT ERRORMESSAGE
 NEWLINE
 NEWLINE
 TERMINATE
END















